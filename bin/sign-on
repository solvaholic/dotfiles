#!/bin/sh

#
# Use this script to do some housekeeping when you sign on.
#
# Usage:
#   [DEBUG=1] sign-on

# shellcheck disable=SC1117
# shellcheck disable=SC2039

_self="${0##*/}"

# Load ~/.dotfiles.conf and $DOTFILES_ROOT/dotfiles.sh.
# TODO: Figure out how not to disable SC1090
# shellcheck disable=SC1090
. ~/.dotfiles.conf || exit
# shellcheck disable=SC1090
. "$DOTFILES_ROOT/dotfiles.sh" || exit
debug "$_self: Loaded ~/.dotfiles.conf and ran $DOTFILES_ROOT/dotfiles.sh OK."

main () {
  check_preq || return 1
  # run_updates || _result=$_result+1
  # prune_docker || _result=$_result+1
  # pull_docker || _result=$_result+1
  _mux -s dotfiles -w docker "$DOTFILES_ROOT/bin/docker-clean"
  # pull_repos || _result=$_result+1
  link_dirs || _result=$_result+1
  return $((_result))
}

link_dirs () {
  info "$_self: Linking directories."
  _result=0
  mkdir -p ~/Local
  link_file "$DOTFILES_ROOT/bin" ~/"Local/bin" || _result=$_result+1
  link_file "Library/Mobile Documents/com~apple~CloudDocs" ~/"iCloud" || _result=$_result+1
  return $((_result))
}

if ! main; then
  echo "That did not work."
  exit 1
fi
